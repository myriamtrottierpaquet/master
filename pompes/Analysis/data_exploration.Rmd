---
title: "Data exploration"
author: "Myriam Trottier-Paquet"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(magrittr)
library(ggplot2)
```

Droppings cort were assay by the Centre d'Étude Biologique de Chizé
```{r}
cort <- readxl::read_xlsx("../data/CORT_zoo.xlsx",
                              sheet = 1, 
                              col_names = T, 
                              na = c("-", ""))


#quick overview
glimpse(cort)
head(cort) ;tail(cort)
summary(cort)
dim(cort)

#quick plot
ggplot(subset(cort, species=="Canada Goose"), aes(date, cort))+geom_point()+geom_smooth()+ggtitle("Canada Goose") + 
  annotate("rect", xmin = as.POSIXct("2022-04-02 10:00:00.00"), xmax = as.POSIXct("2022-04-07 06:00:00.00"), ymin = 30, ymax = 360,  colour="darkgreen" ,fill = "darkgreen", alpha=.3)+ 
  annotate("rect", xmin = as.POSIXct("2022-04-07 10:00:00.00"), xmax = as.POSIXct("2022-04-12 06:00:00.00"), ymin = 30, ymax = 360,  colour="black",  fill = "black", alpha=.3)+ 
  annotate("rect", xmin = as.POSIXct("2022-04-01 10:00:00.00"), xmax = as.POSIXct("2022-04-02 06:00:00.00"), ymin = 30, ymax = 360,  colour="white",  fill = "white", alpha=.8) 
ggplot(subset(cort, species=="Snow Goose"), aes(date, cort))+geom_point()+geom_smooth()+ggtitle("Snow Goose")+ annotate("rect",
    xmin = as.POSIXct("2022-04-16 10:00:00.00"), xmax = as.POSIXct("2022-04-21 06:00:00.00"), ymin = 25, ymax = 365,  colour="darkgreen",  fill = "darkgreen", alpha=.3)+ annotate("rect",
    xmin = as.POSIXct("2022-04-21 10:00:00.00"), xmax = as.POSIXct("2022-04-26 06:00:00.00"), ymin = 25, ymax = 365,  colour="black",  fill = "black", alpha=.3)+ 
  annotate("rect", xmin = as.POSIXct("2022-04-15 10:00:00.00"), xmax = as.POSIXct("2022-04-16 06:00:00.00"), ymin = 25, ymax = 365,  colour="white",  fill = "white", alpha=.5)  
```


```{r}
zoo <- readxl::read_xlsx("../data/Zoo2022.xlsx",
                              sheet = 1, 
                              col_names = T, 
                              na = c("-", ""))


col_cago<-paletteer::paletteer_d("colorBlindness::Brown2Blue12Steps")[1:5]
col_cago<-c("#331900FF", "#662F00FF", "#996035FF", "#CC9B7AFF", "#D8AF97FF")
col_sngo<-paletteer::paletteer_d("colorBlindness::Brown2Blue12Steps")[7:12]
#With dplyr
#Using dplyr; always takes and gives a dataframe
glimpse(zoo)

zoo <- zoo %>%
  mutate(HeureDebut = ymd_hms(paste(DateChirurgie, format(HeureDebut, format = "%H:%M:%S"))),
         HeureFin = ymd_hms(paste(DateChirurgie, format(HeureFin, format = "%H:%M:%S"))),
         Jour=difftime(Date,DateChirurgie, units="days"),
         JourTRT=as.numeric(Jour),
         TempsTRT=cut(JourTRT, breaks=c(-Inf, -1,5,7,13,Inf), labels=c("Avant", "Jour 0", "Jour 6", "Jour 10/12", "Après"))) %>%
  filter(!is.na(Masse))

glimpse(zoo)

CAGO<-subset(zoo, Sp=="CAGO"& Date >= "2022-04-01" & Date <= "2022-04-12")
SNGO<-subset(zoo, Sp=="SNGO"& Date >= "2022-04-15")
# Create a sequence of dates within your desired range
date_range <- seq(as.Date("2022-04-03"), as.Date("2022-04-12"), by="days")

plot_cago<-ggplot(subset(cort, species=="Canada Goose"), aes(date, cort))+ scale_y_continuous(name="Corticosterone (in pg/mg) in dropping samples", sec.axis=sec_axis(trans=~.*15+1000, name="Canada goose mass (in g)")) +geom_point(color="black")+geom_smooth(color="black")+ggtitle("Canada Goose") + 
  annotate("rect", xmin = as.POSIXct("2022-04-02 10:00:00.00"), xmax = as.POSIXct("2022-04-07 06:00:00.00"), ymin = 30, ymax = 360,  colour="darkgreen", fill = "darkgreen", alpha=.3)+ 
  annotate("rect", xmin = as.POSIXct("2022-04-07 10:00:00.00"), xmax = as.POSIXct("2022-04-12 06:00:00.00"), ymin = 30, ymax = 360,  colour="black",  fill = "black", alpha=.3)+ 
  annotate("rect", xmin = as.POSIXct("2022-04-01 10:00:00.00"), xmax = as.POSIXct("2022-04-02 06:00:00.00"), ymin = 30, ymax = 360,  colour="white",  fill = "white", alpha=.8)+
  geom_point(aes(Date, (Masse-1000)/15, colour=ID), data=CAGO, size=3)+scale_color_manual(values=col_cago)+
  theme(
    axis.title.y = element_text(color = "black"),
    axis.text.y = element_text(color = "black"),
    axis.title.y.right = element_text(color = "#996035FF"),
    axis.text.y.right = element_text(color = "#996035FF"))


plot_sngo<-ggplot(subset(cort, species=="Snow Goose"), aes(date, cort))+ scale_y_continuous(name="Corticosterone (in pg/mg) in dropping samples", sec.axis=sec_axis(trans=~.*15+1000, name="Snow goose mass (in g)")) +geom_point()+geom_smooth(color="black")+ggtitle("Snow Goose")+ annotate("rect",
    xmin = as.POSIXct("2022-04-16 10:00:00.00"), xmax = as.POSIXct("2022-04-21 06:00:00.00"), ymin = 25, ymax = 365,  colour="darkgreen",  fill = "darkgreen", alpha=.3)+ annotate("rect",
    xmin = as.POSIXct("2022-04-21 10:00:00.00"), xmax = as.POSIXct("2022-04-26 06:00:00.00"), ymin = 25, ymax = 365,  colour="black",  fill = "black", alpha=.3)+ 
  annotate("rect", xmin = as.POSIXct("2022-04-15 10:00:00.00"), xmax = as.POSIXct("2022-04-16 06:00:00.00"), ymin = 25, ymax = 365,  colour="white",  fill = "white", alpha=.5)+
  geom_point(aes(Date, (Masse-1000)/15, colour=ID), data=SNGO, size=3)+scale_color_manual(values=col_sngo)+
  theme(
    axis.title.y = element_text(color = "black"),
    axis.text.y = element_text(color = "black"),
    axis.title.y.right = element_text(color = "#007A99FF"),
    axis.text.y.right = element_text(color = "#007A99FF"))

plot_cago
plot_sngo

```

<br> Corticosterone content in droppings and fattening pattern for Canada goose and greater snow goose during experiment at Zoo sauvage de St-Félicien in 2022. Phases of the experiment are represented by the shaded area: white being the recuperation phase, green the experimental treatment and black the control treatment. 
